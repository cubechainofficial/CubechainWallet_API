<?
echo "cccc";

exit;

$fromAddr=$req['params']['fromWallet'];
$privateKey=$req['params']['privateKey'];
$toAddr=$req['params']['toWallet'];
$amount=$req['params']['coinAmount'];

$fromAddr=trim($fromAddr);
$toAddr=trim($toAddr);


$aArr="no";

if(!$fromAddr) jsonErrorResult(606);
if(!$privateKey) jsonErrorResult(611);

$pverify=pkVerify($fromAddr,$privateKey);
if(!$pverify) jsonErrorResult(612);

$paysum=0;


if(is_array($toAddr)) {
	if(is_array($amount)) {
		$aArr="yes";
		if(count($toAddr)!=count($amount)) jsonErrorResult(613);
		foreach($amount as $v) {
			if(!is_numeric($v) || $v<=0) jsonErrorResult(602);
		}
	} else {
		if(!is_numeric($amount) || $amount<=0) jsonErrorResult(602);
	}
	foreach($toAddr as $k=>$val) {
		if(!$val) jsonErrorResult(607);
		if($aArr=="yes") {
			$txArr[$val]=$amount[$k];
		} else {
			$txArr[$val]=$amount;
		}
		$paysum+=$txArr[$val];
	}
} else {
	if(!$toAddr) jsonErrorResult(607);
	if(!is_numeric($amount) || $amount<=0) jsonErrorResult(602);
	$txArr=array($toAddr=>$amount);
	$paysum=$amount;
}


$cubeno=0;
$blockno=0;
$sum=0;

$symbol="QUB";
$balance=check_balance($fromAddr,$symbol);
//echo $balance."<br>";
if($paysum>$balance) jsonErrorResult(604);

$txhash=array();
foreach($txArr as $uaddr=>$coin) {
	if($blockno>24) $blockno=1;
	//echo $fromAddr." => ".$uaddr." ".$coin."<br>";
	$tdata=TxMake($fromAddr,$uaddr,$coin,$privateKey);
	if(!$tdata) jsonErrorResult(614);
	$txhash[]=$tdata;
	$sum+=$coin;
}


$res['data']=array();

if(count($txhash)==1) {
	$res['data']['txhash']=$txhash[0];
} else {
	$res['data']['txhash']=$txhash;
}

$res['data']['totalAmount']=$sum;
$res['success']='OK';
$res['msg']='코인 이체에 성공했습니다.';











exit;


function TxMake2($addr,$uaddr,$coin,$pkey) {
	global $datetime,$cubeno,$blockno;
	$data['tax']="0";
	$data['fee']="0.0001";
	$data['txtype']="1";
	$data['auto_ok']="no";
	$data['esc_ok']="no";
	$data['esc_tr']="no";
	$data['esc_end']="0000-00-00 00:00:00";
	$data['esc_key']="";
	$data['alltype']="일반출금";
	$data['note']="";
	$data['smsg']="";
	$data['deposit_msg']="";
	$data['withdraw_msg']="";
	$data['cubeno']=$cubeno;
	$data['blockno']=$blockno;
	$data['token_key']="";
	$data['addr_db']=dbAddress($addr);
	$data['u_addr_db']=dbAddress($uaddr);
	$data['tps_cnt']=0;
	$data['ip']=$_SERVER['REMOTE_ADDR'];
	$data['joindate']=$datetime;
	//if($cubeno>0) $data['stat']=30; else $data['stat']=1;
	$data['stat']=30;

	$data['addr']=$addr;
	$data['u_addr']=$uaddr;
	$data['coin']=$coin;
	$data['symbol']="QUB";
	$timestamp=strtotime($data['joindate']);
	$hash=$data['addr']."|".$data['u_addr']."|".$data['coin']."|".$data['fee']."|".$data['tax']."||".$timestamp."|".$data['token_key']."|".$data['symbol'];
	echo $hash."<br><br>";
	$hash=hash("sha256",$hash);
	$data['signs']=exec("/home/www/wallet_api/html/tool/cwallet sign ".$pkey." ".$hash);

	echo $data['signs']."<br><br>";
	$hash2=$data['addr']."|".$data['u_addr']."|".$data['coin']."|".$data['fee']."|".$data['tax']."|".$data['signs']."|".$timestamp."|".$data['token_key']."|".$data['symbol'];
	$data['hash']=hash("sha256",$hash2);

	echo $data['hash']."<br><br>";

	$rs=dataInsert("tx_pool",$data);
	if($rs) {
		return $data['hash'];
	} else {
		return "";
	}
}

$addr="CJYELY83ouH3brkFVFyatoPXaYQGGtb9uR";
$uaddr="Cbgs7xGAJprLu6Z3pBnZSxTKPwHMwwWuuc";
$coin=10;
$pkey="#b";

echo TxMake2($addr,$uaddr,$coin,$pkey);


exit;





















//Define('Apikey','023dfa74bdc59a59adf4a5e0f5992b86d26ebebcb8c95c6c');
function apiCallGet($url) {
	$ch = curl_init();
	$timeout = 10;
	curl_setopt($ch, CURLOPT_URL, $url);
	curl_setopt ($ch, CURLOPT_HEADER, 0);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
	curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, $timeout);
	$data = curl_exec($ch);
	curl_close($ch);
	return $data;
}


$url="https://api.hanbitco.com";

$trading_pair_name="QUBT-BTC";
$content="?trading_pair_name=".$trading_pair_name;
$path="/v1/ticker/".$content;
$url.=$path;

$res=apiCallGet($url);
$result=json_decode($res);

print_r($result);


exit;


$length=40;
$v=genRandString($length);

echo $v;

exit;
$addr="CNqz8Re3kmRGpiLpjK67cXurEJ8ctLjn1W";
$pkey="#g";
$c=pkVerify($addr,$pkey);

if($c) echo "verrrrrrrrrrrrrri"; else echo "fffffffffffffffffffff";



?>


